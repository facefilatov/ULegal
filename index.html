<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>ULegal? For United Airlines Flight Attendants</title>
<style>
:root{
  --navy:#054A91;
  --primary:#005DAA;
  --accent:#FFC425;
  --bg:#F0F2F5;
  --card-bg: rgba(255,255,255,0.92);
  --card-border: rgba(4,64,120,0.08);
  --input-bg: rgba(247,249,251,0.95);
  --panel: rgba(230,240,250,0.95);
  --panel-border: rgba(196,217,245,1);
  --danger-bg: rgba(255,230,230,1);
  --danger-border: rgba(220,60,60,1);
  --danger-text: #A40000;
  --muted:#6F7780;
  --legal:#b0b9bf;
}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg);}
.centered{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:95%;max-width:480px;box-sizing:border-box;}
.card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:18px;padding:24px;box-shadow:0 18px 40px rgba(4,64,120,0.12);backdrop-filter: blur(6px);max-height:85vh;overflow-y:auto;}
.header{text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:16px;}
.title{font-size:1.7rem;font-weight:700;color:var(--primary);}
.subtitle{font-size:0.95rem;background:rgba(255,196,37,0.12);color:var(--accent);padding:6px 10px;border-radius:14px;font-weight:700;text-align:center;}
.sub-subtitle{font-size:0.9rem;background:transparent;color:var(--muted);font-weight:600;text-align:center;}
.form-row{display:flex;justify-content:space-between;align-items:center;margin:12px 0;flex-wrap:nowrap;}
.label{flex:0 0 auto;text-align:left;font-weight:700;color:var(--navy);white-space:nowrap;}
.label .light-label{font-weight:400;font-size:0.85rem;color:#888;margin-left:6px;display:inline-block;}
.controls{flex:0 0 auto;display:flex;justify-content:flex-end;align-items:center;}
.inline-input{display:flex;gap:6px;align-items:center;justify-content:flex-end;}

/* Dynamic width and font for inputs */
.input{
  flex: 0 0 auto;
  width: 52px;
  padding: 6px 4px;
  border-radius: 8px;
  border:1px solid var(--panel-border);
  background: var(--input-bg);
  text-align:center;
  font-size: clamp(11px,2.5vw,15px);
  box-sizing:border-box;
}
.input::placeholder{font-size:clamp(9px,2vw,11px);}
.input::-webkit-outer-spin-button, .input::-webkit-inner-spin-button { -webkit-appearance:none;margin:0; }

.output{
  min-width:120px;
  max-width:100%;
  padding:10px;
  border-radius:10px;
  background:var(--panel);
  border:1px solid var(--panel-border);
  text-align:center;
  font-weight:800;
  color:var(--navy);
  word-wrap: break-word;
  font-size: clamp(12px,3vw,16px);
}
.output.error {
  background: var(--danger-bg);
  border:1px solid var(--danger-border);
  color: var(--danger-text);
  font-size: clamp(10px,2.5vw,14px);
}

.meta-link{display:block;margin-top:8px;color:var(--primary);text-decoration:underline;cursor:pointer;font-size:0.95rem;text-align:center;}
.version{font-size:12px;color:var(--muted);margin-top:10px;text-align:center;}
.footer-credit{font-size:13px;color:var(--muted);margin-top:6px;text-align:center;font-weight:600;}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:2000;}
.modal{width:92%;max-width:760px;background:#fff;border-radius:12px;padding:18px;box-sizing:border-box;max-height:80vh;overflow:auto;}
.modal h3{margin-top:0;}
.bottom-disclaimer{position:fixed;bottom:0;width:100%;padding:12px 8px;text-align:center;font-size:12px;color:var(--legal);background:var(--bg);box-sizing:border-box;z-index:1000;border-top:1px solid #ccc;}
@media(max-width:460px){
  .input{width:48px;padding:5px 3px;}
  .input::placeholder{font-size:9px;}
  .output{min-width:110px;}
}
</style>
</head>
<body>

<div class="centered">
  <div id="calcCard" class="card">
    <div class="header">
      <div class="title">ULegal</div>
      <div class="subtitle">Maximum Legal Duty Time Calculator for United Airlines Flight Attendants</div>
      <div class="sub-subtitle">Domestic Only</div>
    </div>

    <!-- Report Time -->
    <div class="form-row">
      <div class="label">Report Time <span class="light-label">actual</span></div>
      <div class="controls">
        <div class="inline-input">
          <input id="reportHour" class="input" type="text" inputmode="numeric" placeholder="Hours">
          <input id="reportMin" class="input" type="text" inputmode="numeric" placeholder="Minutes">
        </div>
      </div>
    </div>

    <!-- Duty Hours -->
    <div class="form-row">
      <div class="label">Duty Hours <span class="light-label">scheduled</span></div>
      <div class="controls">
        <div class="inline-input">
          <input id="dutyHours" class="input" type="text" inputmode="numeric" placeholder="Hours">
          <input id="dutyMins" class="input" type="text" inputmode="numeric" placeholder="Minutes">
        </div>
      </div>
    </div>

    <!-- Departure -->
    <div class="form-row">
      <div class="label">Departure <span class="light-label">scheduled</span></div>
      <div class="controls">
        <div class="inline-input">
          <input id="depHour" class="input" type="text" inputmode="numeric" placeholder="Hours">
          <input id="depMin" class="input" type="text" inputmode="numeric" placeholder="Minutes">
        </div>
      </div>
    </div>

    <!-- Door Closed -->
    <div class="form-row">
      <div class="label">Door Closed</div>
      <div class="controls">
        <div id="doorClosed" class="output">—</div>
      </div>
    </div>

    <a id="explainLink" class="meta-link">How we calculated this?</a>
    <div class="version">Public Beta 1.71</div>
    <div class="footer-credit">© 2025 @kirillfilatov</div>
  </div>
</div>

<div class="bottom-disclaimer">
  This tool is not an official United Airlines product. It is provided solely for informational purposes and should not be used as a substitute for the JCBA. Users should independently verify all results before operational action.
</div>

<div id="modalBackdrop" class="modal-backdrop">
  <div class="modal">
    <h3>Calculation: Step-by-step (Report Time = actual)</h3>
    <div id="modalContent"></div>
    <div style="text-align:right;margin-top:12px;"><button id="closeModal">Close</button></div>
  </div>
</div>

<script>
const pad2=n=>String(n).padStart(2,'0');
const onlyDigits=s=>(s||'').replace(/\D/g,'');
const toIntSafe=(s,max)=>{const v=onlyDigits(s);if(!v)return NaN;let n=parseInt(v,10);return isNaN(n)?NaN:Math.min(Math.max(n,0),max??n);};
const minutesFromInputs=(h,m)=>{const hv=toIntSafe(h.value,23),mv=toIntSafe(m.value,59);return isNaN(hv)&&isNaN(mv)?NaN:(isNaN(hv)?0:hv)*60+(isNaN(mv)?0:mv);};
const minutesToHHMM=mins=>{mins=((Math.round(mins)%1440)+1440)%1440;return pad2(Math.floor(mins/60))+':'+pad2(mins%60);};
const computeMaxActual=r=>(r>=300&&r<=1139)?900:690;

const els={
  reportHour:document.getElementById('reportHour'),
  reportMin:document.getElementById('reportMin'),
  dutyHours:document.getElementById('dutyHours'),
  dutyMins:document.getElementById('dutyMins'),
  depHour:document.getElementById('depHour'),
  depMin:document.getElementById('depMin'),
  door:document.getElementById('doorClosed'),
  explainLink:document.getElementById('explainLink'),
  modalBackdrop:document.getElementById('modalBackdrop'),
  modalContent:document.getElementById('modalContent'),
  closeModal:document.getElementById('closeModal')
};

const wireInput=(el,max,nextEl)=>{
  el.addEventListener('input',()=>{
    const raw=onlyDigits(el.value);
    if(!raw){el.value='';els.door.textContent='—';els.door.classList.remove('error');return;}
    let n=parseInt(raw,10);
    if(!isNaN(n)){
      n=Math.max(0,Math.min(n,max));
      el.value=pad2(n);
      if(raw.length>=2&&nextEl)nextEl.focus();
    }
    update();
  });
  el.addEventListener('blur',()=>{if(el.value)el.value=pad2(parseInt(onlyDigits(el.value)||'0',10));});
  el.addEventListener('paste',ev=>{if(/\D/.test((ev.clipboardData||window.clipboardData).getData('text')))ev.preventDefault();});
  el.addEventListener('keydown',ev=>{if(ev.key.length===1&&/\D/.test(ev.key))ev.preventDefault();});
};

wireInput(els.reportHour,23,els.reportMin);
wireInput(els.reportMin,59,els.dutyHours);
wireInput(els.dutyHours,23,els.dutyMins);
wireInput(els.dutyMins,59,els.depHour);
wireInput(els.depHour,23,els.depMin);
wireInput(els.depMin,59);

const update=()=>{
  els.door.classList.remove('error');
  const r=minutesFromInputs(els.reportHour,els.reportMin);
  const duty=minutesFromInputs(els.dutyHours,els.dutyMins);
  const dep=minutesFromInputs(els.depHour,els.depMin);
  if(isNaN(r)||isNaN(duty)||isNaN(dep)){els.door.textContent='—';return;}
  const maxScheduled=(r>=300&&r<=1139)?780:690;
  if(duty>maxScheduled){
    els.door.classList.add('error');
    els.door.textContent='Error. Scheduled duty violates the contract.';
    return;
  }
  const maxActual=computeMaxActual(r);
  const diff=maxActual-duty;
  if(diff<0||!isFinite(diff)){els.door.classList.add('error');els.door.textContent='Error. Verify your times';return;}
  els.door.textContent=minutesToHHMM(dep+diff);
};

els.explainLink.addEventListener('click',()=>{
  const r=minutesFromInputs(els.reportHour,els.reportMin);
  const duty=minutesFromInputs(els.dutyHours,els.dutyMins);
  const dep=minutesFromInputs(els.depHour,els.depMin);
  els.modalContent.innerHTML=`<p>Report Time: ${minutesToHHMM(r)}</p>
  <p>Scheduled Duty: ${minutesToHHMM(duty)}</p>
  <p>Scheduled Departure: ${minutesToHHMM(dep)}</p>
  <p>Max Actual Duty: ${computeMaxActual(r)/60}h</p>
  <p>Time Difference = Max Actual - Scheduled Duty</p>
  <p>Door Closed = Scheduled Departure + Time Difference</p>`;
  els.modalBackdrop.style.display='flex';
});
els.closeModal.addEventListener('click',()=>els.modalBackdrop.style.display='none');
</script>
</body>
</html>
